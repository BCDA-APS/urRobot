# GIXS Automation Sample Database
#
# A sample can either be in the sample reservoir,
# the sample stage, or in the robot's gripper.
# bo records are used to keep track of the sample's location.
# A string record is provided for comments/metadata on the sample.
#
# If for example the InReservoir record's value is set to 1 meaning the
# sample is in the reservoir, InGripper and InSampleStage will 
# automatically be set to 0.

# -------------------------------------------------------------

record(stringout, "$(P)$(R)Sample$(BlockID):Comment")
{
    field(DESC, "Comment about the sample")
    field(VAL, "$(COMMENT)")
}

record(bo, "$(P)$(R)Sample$(BlockID):Measured")
{
    field(DESC, "Sample has been measured")
    field(VAL, 0)
}

# -------------------------------------------------------------

record(bo, "$(P)$(R)Sample$(BlockID):Exists")
{
    field(DESC, "Sample exists")
    field(VAL, "$(EXISTS)")
    field(PINI, "YES")
    field(FLNK, "$(P)$(R)Sample$(BlockID):ExistsCalc.PROC")
}

record(calcout, "$(P)$(R)Sample$(BlockID):ExistsCalc")
{
    field(INPA, "$(P)$(R)Sample$(BlockID):Exists")
    field(CALC, "A")
    field(OOPT, "When Zero")
    field(OUT, "$(P)$(R)Sample$(BlockID):SetAllFalse.PROC")
    field(PINI, "YES")
}

record(seq, "$(P)$(R)Sample$(BlockID):SetAllFalse")
{
    field(LNK0, "$(P)$(R)Sample$(BlockID):InSampleStage PP")
    field(LNK1, "$(P)$(R)Sample$(BlockID):InReservoir PP")
    field(LNK2, "$(P)$(R)Sample$(BlockID):InGripper PP")
    field(LNK3, "$(P)$(R)Sample$(BlockID):Measured PP")
    field(DO0, 0)
    field(DO1, 0)
    field(DO2, 0)
    field(DO3, 0)
}

# -------------------------------------------------------------

record(bo, "$(P)$(R)Sample$(BlockID):InSampleStage")
{
    field(DESC, "Sample is in sample stage")
    field(VAL, 0)
    field(FLNK, "$(P)$(R)Sample$(BlockID):InSampleStageCalc.PROC")
}

record(calcout, "$(P)$(R)Sample$(BlockID):InSampleStageCalc")
{
    field(INPA, "$(P)$(R)Sample$(BlockID):InSampleStage")
    field(CALC, "A")
    field(OOPT, "When Non-zero")
    field(OUT, "$(P)$(R)Sample$(BlockID):InSampleStageSeq.PROC")
}

record(seq, "$(P)$(R)Sample$(BlockID):InSampleStageSeq")
{
    field(LNK0, "$(P)$(R)Sample$(BlockID):InReservoir CA")
    field(LNK1, "$(P)$(R)Sample$(BlockID):InGripper CA")
    field(DO0, 0)
    field(DO1, 0)
}

# -------------------------------------------------------------

record(bo, "$(P)$(R)Sample$(BlockID):InReservoir")
{
    field(DESC, "Sample is in reservoir")
    field(VAL, 1)
    field(FLNK, "$(P)$(R)Sample$(BlockID):InReservoirCalc.PROC")
}

record(calcout, "$(P)$(R)Sample$(BlockID):InReservoirCalc")
{
    field(INPA, "$(P)$(R)Sample$(BlockID):InReservoir")
    field(CALC, "A")
    field(OOPT, "When Non-zero")
    field(OUT, "$(P)$(R)Sample$(BlockID):InReservoirSeq.PROC")
}

record(seq, "$(P)$(R)Sample$(BlockID):InReservoirSeq")
{
    field(LNK0, "$(P)$(R)Sample$(BlockID):InSampleStage CA")
    field(LNK1, "$(P)$(R)Sample$(BlockID):InGripper CA")
    field(DO0, 0)
    field(DO1, 0)
}

# -------------------------------------------------------------

record(bo, "$(P)$(R)Sample$(BlockID):InGripper")
{
    field(DESC, "Sample is in robot gripper")
    field(VAL, 0)
    field(FLNK, "$(P)$(R)Sample$(BlockID):InGripperCalc.PROC")
}

record(calcout, "$(P)$(R)Sample$(BlockID):InGripperCalc")
{
    field(INPA, "$(P)$(R)Sample$(BlockID):InGripper")
    field(CALC, "A")
    field(OOPT, "When Non-zero")
    field(OUT, "$(P)$(R)Sample$(BlockID):InGripperSeq.PROC")
}

record(seq, "$(P)$(R)Sample$(BlockID):InGripperSeq")
{
    field(LNK0, "$(P)$(R)Sample$(BlockID):InSampleStage CA")
    field(LNK1, "$(P)$(R)Sample$(BlockID):InReservoir CA")
    field(DO0, 0)
    field(DO1, 0)
}
