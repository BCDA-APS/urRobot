
#======================
# Status/Connection
#======================

record(bi, "$(P)$(R)Control:Connected")
{
    field(DESC, "RTDE Connection status")
    field(DTYP, "asynInt32")
    field(INP,  "@asyn($(PORT),$(ADDR=0),$(TIMEOUT=1))IS_CONNECTED")
    field(SCAN, "I/O Intr")
}

record(bi, "$(P)$(R)Control:Steady")
{
    field(DESC, "Is robot fully at rest")
    field(DTYP, "asynInt32")
    field(INP,  "@asyn($(PORT),$(ADDR=0),$(TIMEOUT=1))IS_STEADY")
    field(SCAN, "I/O Intr")
}

record(bo, "$(P)$(R)Control:Disconnect")
{
    field(DESC, "Disconnects from the RTDE interface")
    field(DTYP, "asynInt32")
    field(OUT,  "@asyn($(PORT),$(ADDR=0),$(TIMEOUT=1))DISCONNECT")
}

record(bo, "$(P)$(R)Control:Reconnect")
{
    field(DESC, "Tries reconnecting to the RTDE interface")
    field(DTYP, "asynInt32")
    field(OUT,  "@asyn($(PORT),$(ADDR=0),$(TIMEOUT=1))RECONNECT")
}

record(bo, "$(P)$(R)Control:ReuploadControlScript")
{
    field(DESC, "Reuploads control script to controller")
    field(DTYP, "asynInt32")
    field(OUT,  "@asyn($(PORT),$(ADDR=0),$(TIMEOUT=1))REUPLOAD_CONTROL_SCRIPT")
}

record(bo, "$(P)$(R)Control:StopControlScript")
{
    field(DESC, "Stops the control script")
    field(DTYP, "asynInt32")
    field(OUT,  "@asyn($(PORT),$(ADDR=0),$(TIMEOUT=1))STOP_CONTROL_SCRIPT")
}

record(bo, "$(P)$(R)Control:Asynchronous")
{
    field(DESC, "If 1, moves will be asynchronous")
    field(DTYP, "asynInt32")
    field(VAL, 1)
    field(PINI, 1)
    field(OUT,  "@asyn($(PORT),$(ADDR=0),$(TIMEOUT=1))ASYNC_MOVE")
}

record(bi, "$(P)$(R)Control:AsyncMoveDone")
{
    field(DESC, "1 if asynchronous motion complete")
    field(DTYP, "asynInt32")
    field(VAL, 1)
    field(INP,  "@asyn($(PORT),$(ADDR=0),$(TIMEOUT=1))ASYNC_MOVE_DONE")
    field(SCAN, "I/O Intr")
}

record(bo, "$(P)$(R)Control:WaypointGripperAction")
{
    field(DESC, "Gripper action after reaching waypoint")
    field(DTYP, "asynInt32")
    field(OUT,  "@asyn($(PORT),$(ADDR=0),$(TIMEOUT=1))WAYPOINT_GRIPPER_ACTION")
}

#======================
# Joint control
#======================

record(bo, "$(P)$(R)Control:moveJ")
{
    field(DESC, "Moves joints to commanded values")
    field(DTYP, "asynInt32")
    field(OUT,  "@asyn($(PORT),$(ADDR=0),$(TIMEOUT=1))MOVEJ")
}

record(bo, "$(P)$(R)Control:waypoint_moveJ")
{
    field(DESC, "moveJ followed by gripper action")
    field(DTYP, "asynInt32")
    field(OUT,  "@asyn($(PORT),$(ADDR=0),$(TIMEOUT=1))WAYPOINT_MOVEJ")
}

record(ao, "$(P)$(R)Control:JointSpeed")
{
    field(DESC, "Joint speeds for moveJ")
    field(DTYP, "asynFloat64")
    field(PREC, 2)
    field(EGU, "rad/s")
    field(OUT,  "@asyn($(PORT),$(ADDR=0),$(TIMEOUT=1))JOINT_SPEED")
}

record(ao, "$(P)$(R)Control:JointAcceleration")
{
    field(DESC, "Joint accelerations for moveJ")
    field(DTYP, "asynFloat64")
    field(PREC, 2)
    field(EGU, "rad/s/s")
    field(OUT,  "@asyn($(PORT),$(ADDR=0),$(TIMEOUT=1))JOINT_ACCELERATION")
}

record(ao, "$(P)$(R)Control:JointBlend")
{
    field(DESC, "Blend radius for joint paths")
    field(DTYP, "asynFloat64")
    field(PREC, 2)
    field(EGU, "m")
    field(OUT,  "@asyn($(PORT),$(ADDR=0),$(TIMEOUT=1))JOINT_BLEND")
}

record(bo, "$(P)$(R)Control:stopJ")
{
    field(DESC, "Moves joints to commanded values")
    field(DTYP, "asynInt32")
    field(OUT,  "@asyn($(PORT),$(ADDR=0),$(TIMEOUT=1))STOPJ")
}

record(bo, "$(P)$(R)Control:AutoMoveJ")
{
    field(DESC, "If 1, moveJ runs when JxCmd changes")
    field(VAL, 0)
}

record(calcout, "$(P)$(R)Control:auto_moveJ_calc")
{
    field(INPA, "$(P)$(R)Control:AutoMoveJ")
    field(CALC, "A")
    field(OOPT, "When Non-zero")
    field(OUT, "$(P)$(R)Control:moveJ.PROC")
}

# current joint positions for use interally with this database
record(waveform, "$(P)$(R)Control:ActualQ")
{
    field(DESC, "Actual joint positions")     
    field(DTYP, "asynFloat64ArrayIn")
    field(FTVL, "DOUBLE")
    field(PINI, "1")
    field(EGU, "degrees")
    field(INP,  "@asyn($(PORT),$(ADDR=0),$(TIMEOUT=1))ACTUAL_Q")
    field(NELM, 6)
    field(FLNK, "$(P)$(R)Q_index_fanout.PROC")
    field(SCAN, "I/O Intr")
}

record(fanout, "$(P)$(R)Q_index_fanout")
{
    field(LNK0, "$(P)$(R)Control:ActualQ_index0")
    field(LNK1, "$(P)$(R)Control:ActualQ_index1")
    field(LNK2, "$(P)$(R)Control:ActualQ_index2")
    field(LNK3, "$(P)$(R)Control:ActualQ_index3")
    field(LNK4, "$(P)$(R)Control:ActualQ_index4")
    field(LNK5, "$(P)$(R)Control:ActualQ_index5")
}

# subArray to extract each element of ActualQ waveform
record(subArray, "$(P)$(R)Control:ActualQ_index0")
{
    field(INP, "$(P)$(R)Control:ActualQ.VAL")
    field(FTVL, "DOUBLE")
    field(MALM, "6")
    field(NELM, "1")
    field(INDX, "0")
    field(PREC, 4)
}
record(subArray, "$(P)$(R)Control:ActualQ_index1")
{
    field(INP, "$(P)$(R)Control:ActualQ.VAL")
    field(FTVL, "DOUBLE")
    field(MALM, "6")
    field(NELM, "1")
    field(INDX, "1")
    field(PREC, 4)
}
record(subArray, "$(P)$(R)Control:ActualQ_index2")
{
    field(INP, "$(P)$(R)Control:ActualQ.VAL")
    field(FTVL, "DOUBLE")
    field(MALM, "6")
    field(NELM, "1")
    field(INDX, "2")
    field(PREC, 4)
}
record(subArray, "$(P)$(R)Control:ActualQ_index3")
{
    field(INP, "$(P)$(R)Control:ActualQ.VAL")
    field(FTVL, "DOUBLE")
    field(MALM, "6")
    field(NELM, "1")
    field(INDX, "3")
    field(PREC, 4)
}
record(subArray, "$(P)$(R)Control:ActualQ_index4")
{
    field(INP, "$(P)$(R)Control:ActualQ.VAL")
    field(FTVL, "DOUBLE")
    field(MALM, "6")
    field(NELM, "1")
    field(INDX, "4")
    field(PREC, 4)
}
record(subArray, "$(P)$(R)Control:ActualQ_index5")
{
    field(INP, "$(P)$(R)Control:ActualQ.VAL")
    field(FTVL, "DOUBLE")
    field(MALM, "6")
    field(NELM, "1")
    field(INDX, "5")
    field(PREC, 4)
}

# stores DOLx.VAL in LNKx.VAL
# resets commanded joint angles to the current measured angles
record(seq, "$(P)Control:ResetJCmd")
{
    field(PINI, 1)

    field(DOL0, "$(P)$(R)Control:ActualQ_index0")
    field(LNK0, "$(P)$(R)Control:J1Cmd PP")

    field(DOL1, "$(P)$(R)Control:ActualQ_index1")
    field(LNK1, "$(P)$(R)Control:J2Cmd PP")

    field(DOL2, "$(P)$(R)Control:ActualQ_index2")
    field(LNK2, "$(P)$(R)Control:J3Cmd PP")

    field(DOL3, "$(P)$(R)Control:ActualQ_index3")
    field(LNK3, "$(P)$(R)Control:J4Cmd PP")
    
    field(DOL4, "$(P)$(R)Control:ActualQ_index4")
    field(LNK4, "$(P)$(R)Control:J5Cmd PP")

    field(DOL5, "$(P)$(R)Control:ActualQ_index5")
    field(LNK5, "$(P)$(R)Control:J6Cmd PP")
}

# -----------------------------------------------------------

record(ao, "$(P)$(R)Control:J1Cmd")
{
    field(DESC, "Commanded angle(deg) for joint 1")
    field(DTYP, "asynFloat64")
    field(OUT,  "@asyn($(PORT),$(ADDR=0),$(TIMEOUT=1))J1CMD")
    field(EGU, "degrees")
    field(PINI, 1)
    field(PREC, 4)
    field(FLNK, "$(P)$(R)Control:auto_moveJ_calc.PROC")
}
record(ao, "$(P)$(R)Control:J1TweakVal")
{
    field(DESC, "Joint 1 tweak step size")
    field(EGU, "degrees")
    field(PREC, 4)
}
record(bo, "$(P)$(R)Control:J1TweakFwd")
{
    field(DESC, "Tweak joint 1 forward")
    field(FLNK, "$(P)$(R)Control:J1TweakCalcFwd.PROC")
}
record(bo, "$(P)$(R)Control:J1TweakRev")
{
    field(DESC, "Tweak joint 1 backward")
    field(FLNK, "$(P)$(R)Control:J1TweakCalcRev.PROC")
}
record(calcout, "$(P)$(R)Control:J1TweakCalcFwd")
{
    field(INPA, "$(P)$(R)Control:J1Cmd")
    field(INPB, "$(P)$(R)Control:J1TweakVal")
    field(CALC, "A + B")
    field(OUT, "$(P)$(R)Control:J1Cmd PP")
}
record(calcout, "$(P)$(R)Control:J1TweakCalcRev")
{
    field(INPA, "$(P)$(R)Control:J1Cmd")
    field(INPB, "$(P)$(R)Control:J1TweakVal")
    field(CALC, "A - B")
    field(OUT, "$(P)$(R)Control:J1Cmd PP")
}

# -----------------------------------------------------------

record(ao, "$(P)$(R)Control:J2Cmd")
{
    field(DESC, "Commanded angle(deg) for joint 2")
    field(DTYP, "asynFloat64")
    field(OUT,  "@asyn($(PORT),$(ADDR=0),$(TIMEOUT=1))J2CMD")
    field(EGU, "degrees")
    field(PINI, 1)
    field(PREC, 4)
    field(FLNK, "$(P)$(R)Control:auto_moveJ_calc.PROC")
}
record(ao, "$(P)$(R)Control:J2TweakVal")
{
    field(DESC, "Joint 2 tweak step size")
    field(EGU, "degrees")
    field(PREC, 4)
}
record(bo, "$(P)$(R)Control:J2TweakFwd")
{
    field(DESC, "Tweak joint 2 forward")
    field(FLNK, "$(P)$(R)Control:J2TweakCalcFwd.PROC")
}
record(bo, "$(P)$(R)Control:J2TweakRev")
{
    field(DESC, "Tweak joint 2 backward")
    field(FLNK, "$(P)$(R)Control:J2TweakCalcRev.PROC")
}
record(calcout, "$(P)$(R)Control:J2TweakCalcFwd")
{
    field(INPA, "$(P)$(R)Control:J2Cmd")
    field(INPB, "$(P)$(R)Control:J2TweakVal")
    field(CALC, "A + B")
    field(OUT, "$(P)$(R)Control:J2Cmd PP")
}
record(calcout, "$(P)$(R)Control:J2TweakCalcRev")
{
    field(INPA, "$(P)$(R)Control:J2Cmd")
    field(INPB, "$(P)$(R)Control:J2TweakVal")
    field(CALC, "A - B")
    field(OUT, "$(P)$(R)Control:J2Cmd PP")
}

# -----------------------------------------------------------

record(ao, "$(P)$(R)Control:J3Cmd")
{
    field(DESC, "Commanded angle(deg) for joint 3")
    field(DTYP, "asynFloat64")
    field(OUT,  "@asyn($(PORT),$(ADDR=0),$(TIMEOUT=1))J3CMD")
    field(EGU, "degrees")
    field(PINI, 1)
    field(PREC, 4)
    field(FLNK, "$(P)$(R)Control:auto_moveJ_calc.PROC")
}
record(ao, "$(P)$(R)Control:J3TweakVal")
{
    field(DESC, "Joint 3 tweak step size")
    field(EGU, "degrees")
    field(PREC, 4)
}
record(bo, "$(P)$(R)Control:J3TweakFwd")
{
    field(DESC, "Tweak joint 3 forward")
    field(FLNK, "$(P)$(R)Control:J3TweakCalcFwd.PROC")
}
record(bo, "$(P)$(R)Control:J3TweakRev")
{
    field(DESC, "Tweak joint 3 backward")
    field(FLNK, "$(P)$(R)Control:J3TweakCalcRev.PROC")
}
record(calcout, "$(P)$(R)Control:J3TweakCalcFwd")
{
    field(INPA, "$(P)$(R)Control:J3Cmd")
    field(INPB, "$(P)$(R)Control:J3TweakVal")
    field(CALC, "A + B")
    field(OUT, "$(P)$(R)Control:J3Cmd PP")
}
record(calcout, "$(P)$(R)Control:J3TweakCalcRev")
{
    field(INPA, "$(P)$(R)Control:J3Cmd")
    field(INPB, "$(P)$(R)Control:J3TweakVal")
    field(CALC, "A - B")
    field(OUT, "$(P)$(R)Control:J3Cmd PP")
}

# -----------------------------------------------------------

record(ao, "$(P)$(R)Control:J4Cmd")
{
    field(DESC, "Commanded angle(deg) for joint 4")
    field(DTYP, "asynFloat64")
    field(OUT,  "@asyn($(PORT),$(ADDR=0),$(TIMEOUT=1))J4CMD")
    field(EGU, "degrees")
    field(PINI, 1)
    field(PREC, 4)
    field(FLNK, "$(P)$(R)Control:auto_moveJ_calc.PROC")
}
record(ao, "$(P)$(R)Control:J4TweakVal")
{
    field(DESC, "Joint 4 tweak step size")
    field(EGU, "degrees")
    field(PREC, 4)
}
record(bo, "$(P)$(R)Control:J4TweakFwd")
{
    field(DESC, "Tweak joint 4 forward")
    field(FLNK, "$(P)$(R)Control:J4TweakCalcFwd.PROC")
}
record(bo, "$(P)$(R)Control:J4TweakRev")
{
    field(DESC, "Tweak joint 4 backward")
    field(FLNK, "$(P)$(R)Control:J4TweakCalcRev.PROC")
}
record(calcout, "$(P)$(R)Control:J4TweakCalcFwd")
{
    field(INPA, "$(P)$(R)Control:J4Cmd")
    field(INPB, "$(P)$(R)Control:J4TweakVal")
    field(CALC, "A + B")
    field(OUT, "$(P)$(R)Control:J4Cmd PP")
}
record(calcout, "$(P)$(R)Control:J4TweakCalcRev")
{
    field(INPA, "$(P)$(R)Control:J4Cmd")
    field(INPB, "$(P)$(R)Control:J4TweakVal")
    field(CALC, "A - B")
    field(OUT, "$(P)$(R)Control:J4Cmd PP")
}

# -----------------------------------------------------------

record(ao, "$(P)$(R)Control:J5Cmd")
{
    field(DESC, "Commanded angle(deg) for joint 5")
    field(DTYP, "asynFloat64")
    field(OUT,  "@asyn($(PORT),$(ADDR=0),$(TIMEOUT=1))J5CMD")
    field(EGU, "degrees")
    field(PINI, 1)
    field(PREC, 4)
    field(FLNK, "$(P)$(R)Control:auto_moveJ_calc.PROC")
}
record(ao, "$(P)$(R)Control:J5TweakVal")
{
    field(DESC, "Joint 5 tweak step size")
    field(EGU, "degrees")
    field(PREC, 4)
}
record(bo, "$(P)$(R)Control:J5TweakFwd")
{
    field(DESC, "Tweak joint 5 forward")
    field(FLNK, "$(P)$(R)Control:J5TweakCalcFwd.PROC")
}
record(bo, "$(P)$(R)Control:J5TweakRev")
{
    field(DESC, "Tweak joint 5 backward")
    field(FLNK, "$(P)$(R)Control:J5TweakCalcRev.PROC")
}
record(calcout, "$(P)$(R)Control:J5TweakCalcFwd")
{
    field(INPA, "$(P)$(R)Control:J5Cmd")
    field(INPB, "$(P)$(R)Control:J5TweakVal")
    field(CALC, "A + B")
    field(OUT, "$(P)$(R)Control:J5Cmd PP")
}
record(calcout, "$(P)$(R)Control:J5TweakCalcRev")
{
    field(INPA, "$(P)$(R)Control:J5Cmd")
    field(INPB, "$(P)$(R)Control:J5TweakVal")
    field(CALC, "A - B")
    field(OUT, "$(P)$(R)Control:J5Cmd PP")
}

# -----------------------------------------------------------

record(ao, "$(P)$(R)Control:J6Cmd")
{
    field(DESC, "Commanded angle(deg) for joint 6")
    field(DTYP, "asynFloat64")
    field(OUT,  "@asyn($(PORT),$(ADDR=0),$(TIMEOUT=1))J6CMD")
    field(EGU, "degrees")
    field(PINI, 1)
    field(PREC, 4)
    field(FLNK, "$(P)$(R)Control:auto_moveJ_calc.PROC")
}
record(ao, "$(P)$(R)Control:J6TweakVal")
{
    field(DESC, "Joint 6 tweak step size")
    field(EGU, "degrees")
    field(PREC, 4)
}
record(bo, "$(P)$(R)Control:J6TweakFwd")
{
    field(DESC, "Tweak joint 6 forward")
    field(FLNK, "$(P)$(R)Control:J6TweakCalcFwd.PROC")
}
record(bo, "$(P)$(R)Control:J6TweakRev")
{
    field(DESC, "Tweak joint 6 backward")
    field(FLNK, "$(P)$(R)Control:J6TweakCalcRev.PROC")
}
record(calcout, "$(P)$(R)Control:J6TweakCalcFwd")
{
    field(INPA, "$(P)$(R)Control:J6Cmd")
    field(INPB, "$(P)$(R)Control:J6TweakVal")
    field(CALC, "A + B")
    field(OUT, "$(P)$(R)Control:J6Cmd PP")
}
record(calcout, "$(P)$(R)Control:J6TweakCalcRev")
{
    field(INPA, "$(P)$(R)Control:J6Cmd")
    field(INPB, "$(P)$(R)Control:J6TweakVal")
    field(CALC, "A - B")
    field(OUT, "$(P)$(R)Control:J6Cmd PP")
}

#======================
# TCP pose control
#======================

record(bo, "$(P)$(R)Control:moveL")
{
    field(DESC, "Move to TCP pose linearly")
    field(DTYP, "asynInt32")
    field(OUT,  "@asyn($(PORT),$(ADDR=0),$(TIMEOUT=1))MOVEL")
}

record(bo, "$(P)$(R)Control:waypoint_moveL")
{
    field(DESC, "moveL followed by gripper action")
    field(DTYP, "asynInt32")
    field(OUT,  "@asyn($(PORT),$(ADDR=0),$(TIMEOUT=1))WAYPOINT_MOVEL")
}

record(ao, "$(P)$(R)Control:LinearSpeed")
{
    field(DESC, "Linear speed for moveL")
    field(DTYP, "asynFloat64")
    field(PREC, 3)
    field(EGU, "m/s")
    field(OUT,  "@asyn($(PORT),$(ADDR=0),$(TIMEOUT=1))LINEAR_SPEED")
}

record(ao, "$(P)$(R)Control:LinearAcceleration")
{
    field(DESC, "Linear acceleration for moveL")
    field(DTYP, "asynFloat64")
    field(PREC, 3)
    field(EGU, "m/s/s")
    field(OUT,  "@asyn($(PORT),$(ADDR=0),$(TIMEOUT=1))LINEAR_ACCELERATION")
}

record(ao, "$(P)$(R)Control:LinearBlend")
{
    field(DESC, "Linear blend for moveL paths")
    field(DTYP, "asynFloat64")
    field(PREC, 3)
    field(EGU, "m")
    field(OUT,  "@asyn($(PORT),$(ADDR=0),$(TIMEOUT=1))LINEAR_BLEND")
}

record(bo, "$(P)$(R)Control:stopL")
{
    field(DESC, "Stop linear move to TCP pose")
    field(DTYP, "asynInt32")
    field(OUT,  "@asyn($(PORT),$(ADDR=0),$(TIMEOUT=1))STOPL")
}

record(bo, "$(P)$(R)Control:AutoMoveL")
{
    field(DESC, "If 1, moveL runs when Cmd changes")
    field(VAL, 0)
}

record(calcout, "$(P)$(R)Control:auto_moveL_calc")
{
    field(INPA, "$(P)$(R)Control:AutoMoveL")
    field(CALC, "A")
    field(OOPT, "When Non-zero")
    field(OUT, "$(P)$(R)Control:moveL.PROC")
}

record(waveform, "$(P)$(R)Control:ActualTCPPose")
{
    field(DESC, "Actual TCP Pose")     
    field(DTYP, "asynFloat64ArrayIn")
    field(FTVL, "DOUBLE")
    field(PINI, "1")
    field(INP,  "@asyn($(PORT),$(ADDR=0),$(TIMEOUT=1))ACTUAL_TCP_POSE")
    field(NELM, 6)
    field(FLNK, "$(P)$(R)pose_index_fanout.PROC")
    field(SCAN, "I/O Intr")
}

record(fanout, "$(P)$(R)pose_index_fanout")
{
    field(LNK0, "$(P)$(R)Control:pose_index0")
    field(LNK1, "$(P)$(R)Control:pose_index1")
    field(LNK2, "$(P)$(R)Control:pose_index2")
    field(LNK3, "$(P)$(R)Control:pose_index3")
    field(LNK4, "$(P)$(R)Control:pose_index4")
    field(LNK5, "$(P)$(R)Control:pose_index5")
}

# subArray to extract each element of ActualTCPPose waveform
record(subArray, "$(P)$(R)Control:pose_index0")
{
    field(INP, "$(P)$(R)Control:ActualTCPPose.VAL")
    field(FTVL, "DOUBLE")
    field(MALM, "6")
    field(NELM, "1")
    field(INDX, "0")
    field(PREC, 4)
}
record(subArray, "$(P)$(R)Control:pose_index1")
{
    field(INP, "$(P)$(R)Control:ActualTCPPose.VAL")
    field(FTVL, "DOUBLE")
    field(MALM, "6")
    field(NELM, "1")
    field(INDX, "1")
    field(PREC, 4)
}
record(subArray, "$(P)$(R)Control:pose_index2")
{
    field(INP, "$(P)$(R)Control:ActualTCPPose.VAL")
    field(FTVL, "DOUBLE")
    field(MALM, "6")
    field(NELM, "1")
    field(INDX, "2")
    field(PREC, 4)
}
record(subArray, "$(P)$(R)Control:pose_index3")
{
    field(INP, "$(P)$(R)Control:ActualTCPPose.VAL")
    field(FTVL, "DOUBLE")
    field(MALM, "6")
    field(NELM, "1")
    field(INDX, "3")
    field(PREC, 4)
}
record(subArray, "$(P)$(R)Control:pose_index4")
{
    field(INP, "$(P)$(R)Control:ActualTCPPose.VAL")
    field(FTVL, "DOUBLE")
    field(MALM, "6")
    field(NELM, "1")
    field(INDX, "4")
    field(PREC, 4)
}
record(subArray, "$(P)$(R)Control:pose_index5")
{
    field(INP, "$(P)$(R)Control:ActualTCPPose.VAL")
    field(FTVL, "DOUBLE")
    field(MALM, "6")
    field(NELM, "1")
    field(INDX, "5")
    field(PREC, 4)
}

# stores DOLx.VAL in LNKx.VAL
# resets commanded TCP pose to the current measured pose
record(seq, "$(P)Control:ResetPoseCmd")
{
    field(PINI, 1)

    field(DOL0, "$(P)$(R)Control:pose_index0")
    field(LNK0, "$(P)$(R)Control:PoseXCmd PP")

    field(DOL1, "$(P)$(R)Control:pose_index1")
    field(LNK1, "$(P)$(R)Control:PoseYCmd PP")

    field(DOL2, "$(P)$(R)Control:pose_index2")
    field(LNK2, "$(P)$(R)Control:PoseZCmd PP")

    field(DOL3, "$(P)$(R)Control:pose_index3")
    field(LNK3, "$(P)$(R)Control:PoseRollCmd PP")
    
    field(DOL4, "$(P)$(R)Control:pose_index4")
    field(LNK4, "$(P)$(R)Control:PosePitchCmd PP")

    field(DOL5, "$(P)$(R)Control:pose_index5")
    field(LNK5, "$(P)$(R)Control:PoseYawCmd PP")
}

# -----------------------------------------------------------

record(ao, "$(P)$(R)Control:PoseXCmd")
{
    field(DESC, "Commanded TCP X")
    field(DTYP, "asynFloat64")
    field(OUT,  "@asyn($(PORT),$(ADDR=0),$(TIMEOUT=1))POSE_X_CMD")
    field(EGU, "mm")
    field(PINI, 1)
    field(PREC, 4)
    field(FLNK, "$(P)$(R)Control:auto_moveL_calc.PROC")
}
record(ao, "$(P)$(R)Control:PoseXTweakVal")
{
    field(DESC, "X TCP pose tweak step size")
    field(EGU, "m")
    field(PREC, 4)
    field(DRVH, "0.1")
    field(DRVL, "0.0")
}
record(bo, "$(P)$(R)Control:PoseXTweakFwd")
{
    field(DESC, "Tweak X TCP pose forward")
    field(FLNK, "$(P)$(R)Control:PoseXTweakCalcFwd.PROC")
}
record(bo, "$(P)$(R)Control:PoseXTweakRev")
{
    field(DESC, "Tweak X TCP pose backward")
    field(FLNK, "$(P)$(R)Control:PoseXTweakCalcRev.PROC")
}
record(calcout, "$(P)$(R)Control:PoseXTweakCalcFwd")
{
    field(INPA, "$(P)$(R)Control:PoseXCmd")
    field(INPB, "$(P)$(R)Control:PoseXTweakVal")
    field(CALC, "A + B")
    field(OUT, "$(P)$(R)Control:PoseXCmd PP")
}
record(calcout, "$(P)$(R)Control:PoseXTweakCalcRev")
{
    field(INPA, "$(P)$(R)Control:PoseXCmd")
    field(INPB, "$(P)$(R)Control:PoseXTweakVal")
    field(CALC, "A - B")
    field(OUT, "$(P)$(R)Control:PoseXCmd PP")
}

# -----------------------------------------------------------

record(ao, "$(P)$(R)Control:PoseYCmd")
{
    field(DESC, "Commanded TCP Y")
    field(DTYP, "asynFloat64")
    field(OUT,  "@asyn($(PORT),$(ADDR=0),$(TIMEOUT=1))POSE_Y_CMD")
    field(EGU, "mm")
    field(PINI, 1)
    field(PREC, 4)
    field(FLNK, "$(P)$(R)Control:auto_moveL_calc.PROC")
}
record(ao, "$(P)$(R)Control:PoseYTweakVal")
{
    field(DESC, "Y TCP pose tweak step size")
    field(EGU, "m")
    field(PREC, 4)
    field(DRVH, "0.1")
    field(DRVL, "0.0")
}
record(bo, "$(P)$(R)Control:PoseYTweakFwd")
{
    field(DESC, "Tweak Y TCP pose forward")
    field(FLNK, "$(P)$(R)Control:PoseYTweakCalcFwd.PROC")
}
record(bo, "$(P)$(R)Control:PoseYTweakRev")
{
    field(DESC, "Tweak Y TCP pose backward")
    field(FLNK, "$(P)$(R)Control:PoseYTweakCalcRev.PROC")
}
record(calcout, "$(P)$(R)Control:PoseYTweakCalcFwd")
{
    field(INPA, "$(P)$(R)Control:PoseYCmd")
    field(INPB, "$(P)$(R)Control:PoseYTweakVal")
    field(CALC, "A + B")
    field(OUT, "$(P)$(R)Control:PoseYCmd PP")
}
record(calcout, "$(P)$(R)Control:PoseYTweakCalcRev")
{
    field(INPA, "$(P)$(R)Control:PoseYCmd")
    field(INPB, "$(P)$(R)Control:PoseYTweakVal")
    field(CALC, "A - B")
    field(OUT, "$(P)$(R)Control:PoseYCmd PP")
}

# -----------------------------------------------------------


record(ao, "$(P)$(R)Control:PoseZCmd")
{
    field(DESC, "Commanded TCP Z")
    field(DTYP, "asynFloat64")
    field(OUT,  "@asyn($(PORT),$(ADDR=0),$(TIMEOUT=1))POSE_Z_CMD")
    field(EGU, "mm")
    field(PINI, 1)
    field(PREC, 4)
    field(FLNK, "$(P)$(R)Control:auto_moveL_calc.PROC")
}
record(ao, "$(P)$(R)Control:PoseZTweakVal")
{
    field(DESC, "TCP Z tweak step size")
    field(EGU, "m")
    field(PREC, 4)
    field(DRVH, "0.1")
    field(DRVL, "0.0")
}
record(bo, "$(P)$(R)Control:PoseZTweakFwd")
{
    field(DESC, "Tweak TCP Z forward")
    field(FLNK, "$(P)$(R)Control:PoseZTweakCalcFwd.PROC")
}
record(bo, "$(P)$(R)Control:PoseZTweakRev")
{
    field(DESC, "Tweak TCP Z backward")
    field(FLNK, "$(P)$(R)Control:PoseZTweakCalcRev.PROC")
}
record(calcout, "$(P)$(R)Control:PoseZTweakCalcFwd")
{
    field(INPA, "$(P)$(R)Control:PoseZCmd")
    field(INPB, "$(P)$(R)Control:PoseZTweakVal")
    field(CALC, "A + B")
    field(OUT, "$(P)$(R)Control:PoseZCmd PP")
}
record(calcout, "$(P)$(R)Control:PoseZTweakCalcRev")
{
    field(INPA, "$(P)$(R)Control:PoseZCmd")
    field(INPB, "$(P)$(R)Control:PoseZTweakVal")
    field(CALC, "A - B")
    field(OUT, "$(P)$(R)Control:PoseZCmd PP")
}

# -----------------------------------------------------------

record(ao, "$(P)$(R)Control:PoseRollCmd")
{
    field(DESC, "Commanded TCP roll")
    field(DTYP, "asynFloat64")
    field(OUT,  "@asyn($(PORT),$(ADDR=0),$(TIMEOUT=1))POSE_ROLL_CMD")
    field(EGU, "degrees")
    field(PINI, 1)
    field(PREC, 4)
    field(FLNK, "$(P)$(R)Control:auto_moveL_calc.PROC")
}
record(ao, "$(P)$(R)Control:PoseRollTweakVal")
{
    field(DESC, "TCP roll tweak step size")
    field(EGU, "degrees")
    field(PREC, 4)
    field(DRVL, "0.0")
}
record(bo, "$(P)$(R)Control:PoseRollTweakFwd")
{
    field(DESC, "Tweak TCP roll forward")
    field(FLNK, "$(P)$(R)Control:PoseRollTweakCalcFwd.PROC")
}
record(bo, "$(P)$(R)Control:PoseRollTweakRev")
{
    field(DESC, "Tweak TCP roll backward")
    field(FLNK, "$(P)$(R)Control:PoseRollTweakCalcRev.PROC")
}
record(calcout, "$(P)$(R)Control:PoseRollTweakCalcFwd")
{
    field(INPA, "$(P)$(R)Control:PoseRollCmd")
    field(INPB, "$(P)$(R)Control:PoseRollTweakVal")
    field(CALC, "A + B")
    field(OUT, "$(P)$(R)Control:PoseRollCmd PP")
}
record(calcout, "$(P)$(R)Control:PoseRollTweakCalcRev")
{
    field(INPA, "$(P)$(R)Control:PoseRollCmd")
    field(INPB, "$(P)$(R)Control:PoseRollTweakVal")
    field(CALC, "A - B")
    field(OUT, "$(P)$(R)Control:PoseRollCmd PP")
}

# -----------------------------------------------------------

record(ao, "$(P)$(R)Control:PosePitchCmd")
{
    field(DESC, "Commanded TCP pitch")
    field(DTYP, "asynFloat64")
    field(OUT,  "@asyn($(PORT),$(ADDR=0),$(TIMEOUT=1))POSE_PITCH_CMD")
    field(EGU, "degrees")
    field(PINI, 1)
    field(PREC, 4)
    field(FLNK, "$(P)$(R)Control:auto_moveL_calc.PROC")
}
record(ao, "$(P)$(R)Control:PosePitchTweakVal")
{
    field(DESC, "TCP pitch tweak step size")
    field(EGU, "degrees")
    field(PREC, 4)
    field(DRVL, "0.0")
}
record(bo, "$(P)$(R)Control:PosePitchTweakFwd")
{
    field(DESC, "Tweak TCP pitch forward")
    field(FLNK, "$(P)$(R)Control:PosePitchTweakCalcFwd.PROC")
}
record(bo, "$(P)$(R)Control:PosePitchTweakRev")
{
    field(DESC, "Tweak TCP pitch backward")
    field(FLNK, "$(P)$(R)Control:PosePitchTweakCalcRev.PROC")
}
record(calcout, "$(P)$(R)Control:PosePitchTweakCalcFwd")
{
    field(INPA, "$(P)$(R)Control:PosePitchCmd")
    field(INPB, "$(P)$(R)Control:PosePitchTweakVal")
    field(CALC, "A + B")
    field(OUT, "$(P)$(R)Control:PosePitchCmd PP")
}
record(calcout, "$(P)$(R)Control:PosePitchTweakCalcRev")
{
    field(INPA, "$(P)$(R)Control:PosePitchCmd")
    field(INPB, "$(P)$(R)Control:PosePitchTweakVal")
    field(CALC, "A - B")
    field(OUT, "$(P)$(R)Control:PosePitchCmd PP")
}

# -----------------------------------------------------------

record(ao, "$(P)$(R)Control:PoseYawCmd")
{
    field(DESC, "Commanded TCP yaw")
    field(DTYP, "asynFloat64")
    field(OUT,  "@asyn($(PORT),$(ADDR=0),$(TIMEOUT=1))POSE_YAW_CMD")
    field(EGU, "degrees")
    field(PINI, 1)
    field(PREC, 4)
    field(FLNK, "$(P)$(R)Control:auto_moveL_calc.PROC")
}
record(ao, "$(P)$(R)Control:PoseYawTweakVal")
{
    field(DESC, "TCP yaw tweak step size")
    field(EGU, "degrees")
    field(PREC, 4)
    field(DRVL, "0.0")
}
record(bo, "$(P)$(R)Control:PoseYawTweakFwd")
{
    field(DESC, "Tweak TCP yaw forward")
    field(FLNK, "$(P)$(R)Control:PoseYawTweakCalcFwd.PROC")
}
record(bo, "$(P)$(R)Control:PoseYawTweakRev")
{
    field(DESC, "Tweak TCP yaw backward")
    field(FLNK, "$(P)$(R)Control:PoseYawTweakCalcRev.PROC")
}
record(calcout, "$(P)$(R)Control:PoseYawTweakCalcFwd")
{
    field(INPA, "$(P)$(R)Control:PoseYawCmd")
    field(INPB, "$(P)$(R)Control:PoseYawTweakVal")
    field(CALC, "A + B")
    field(OUT, "$(P)$(R)Control:PoseYawCmd PP")
}
record(calcout, "$(P)$(R)Control:PoseYawTweakCalcRev")
{
    field(INPA, "$(P)$(R)Control:PoseYawCmd")
    field(INPB, "$(P)$(R)Control:PoseYawTweakVal")
    field(CALC, "A - B")
    field(OUT, "$(P)$(R)Control:PoseYawCmd PP")
}
# -----------------------------------------------------------

#======================
# Path Following
#======================

record(stringout, "$(P)$(R)Control:CartesianPathCsvFile")
{
    field(OUT, "$(P)$(R)Control:PlayCartesianPathFromCsvFile NPP")
}
record(stringout, "$(P)$(R)Control:PlayCartesianPathFromCsvFile")
{
    field(DESC, "Moves through CSV file of poses")
    field(DTYP, "asynOctetWrite")
    field(OUT,  "@asyn($(PORT),$(ADDR=0),$(TIMEOUT=1))PLAY_CARTESIAN_PATH_CSV")
}

record(stringout, "$(P)$(R)Control:JointPathCsvFile")
{
    field(OUT, "$(P)$(R)Control:PlayJointPathFromCsvFile NPP")
}
record(stringout, "$(P)$(R)Control:PlayJointPathFromCsvFile")
{
    field(DESC, "Moves through CSV file of joint angles")
    field(DTYP, "asynOctetWrite")
    field(OUT,  "@asyn($(PORT),$(ADDR=0),$(TIMEOUT=1))PLAY_JOINT_PATH_CSV")
}
