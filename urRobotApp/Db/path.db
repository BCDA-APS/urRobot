# Type of K'th waypoint in path N
record(mbbo, "$(P)Path$(N):$(K):Type") {
    field(ZRST,"Linear") # Cartesian waypoint (WaypointL)
    field(ONST,"Joint") # Joint waypoint (WaypointJ)
    field(VAL, "$(TYPE=0)")
    field(FLNK, "$(P)Path$(N):$(K):get_desc.PROC")
}

# Waypoint number of K'th waypoint in path N
record(longout, "$(P)Path$(N):$(K):Number") {
    field(VAL, "$(WP_NUM=0)")
    field(FLNK, "$(P)Path$(N):$(K):get_desc.PROC")
}

# Action override of K'th waypoint in path N
record(mbbo, "$(P)Path$(N):$(K):ActionOverride") {
    field(ZRST, "Custom")
    field(ONST, "Open gripper")
    field(TWST, "Close gripper")
    field(THST, "None")
    field(VAL, "$(ACTION=3)")
    field(FLNK, "$(P)Path$(N):$(K):get_desc.PROC")
}

# Enable/disable K'th waypoint in path N
record(bo, "$(P)Path$(N):$(K):Enabled") {
    field(DESC, "1 if path point enabled, else 0")
    field(ZNAM, "0")
    field(ONAM, "1")
    field(VAL, 0)
    field(FLNK, "$(P)Path$(N):$(K):get_desc.PROC")
}

record(luascript, "$(P)Path$(N):$(K):get_desc") {
    field(CODE, "@paths.lua get_desc({prefix='$(P)',N=$(N),k=$(K)})")
    field(PINI, 1)
}

record(stringin, "$(P)Path$(N):$(K):Desc") {
    field(INP, "$(P)Path$(N):$(K):get_desc.SVAL CP")
}

# NOTE: lua epics.put directly to ActionOpt PV throws mutex error,
# probably because of logic in waypoint databases, which is why we
# need to do the following
record(longout, "$(P)Path$(N):$(K):action_opt_val") {}
record(seq, "$(P)Path$(N):$(K):set_action_opt") {
    field(DOL0, "$(P)Path$(N):$(K):action_opt_val.VAL CP")
}
