# Type of K'th waypoint in path N
record(mbbo, "$(P)Path$(N):$(K):Type") {
    field(DESC, "Type of waypoint for waypoint in path")
    field(ZRST,"Linear") # Cartesian waypoint (WaypointL)
    field(ONST,"Joint") # Joint waypoint (WaypointJ)
    field(VAL, "$(TYPE=0)")
    field(FLNK, "$(P)Path$(N):$(K):get_wp_info.PROC")
}

# Waypoint number of K'th waypoint in path N
record(longout, "$(P)Path$(N):$(K):Number") {
    field(DESC, "Waypoint number for waypoint in path")
    field(VAL, "$(WP_NUM=0)")
    field(FLNK, "$(P)Path$(N):$(K):get_wp_info.PROC")
}

# Action override of K'th waypoint in path N
record(mbbo, "$(P)Path$(N):$(K):ActionOverride") {
    field(DESC, "Action override for waypoint in path")
    field(ZRST, "None")
    field(ONST, "Action 1")
    field(TWST, "Action 2")
    field(THST, "Action 3")
    field(FRST, "Action 4")
    field(FVST, "Action 5")
    field(SXST, "Action 6")
    field(SVST, "Action 7")
    field(EIST, "Action 8")
    field(NIST, "Action 9")
    field(TEST, "Action 10")
    field(VAL, "$(ACTION=3)")
}

# Enable/disable K'th waypoint in path N
record(bo, "$(P)Path$(N):$(K):Enabled") {
    field(DESC, "1 if waypoint in path enabled, else 0")
    field(ZNAM, "0")
    field(ONAM, "1")
    field(VAL, 0)
    field(FLNK, "$(P)Path$(N):$(K):get_wp_info.PROC")
}

record(luascript, "$(P)Path$(N):$(K):get_wp_info") {
    field(CODE, "@paths.lua get_wp_info({prefix='$(P)',N=$(N),k=$(K)})")
    field(PINI, 1)
}

record(stringin, "$(P)Path$(N):$(K):Desc") {
    field(DESC, "Description of waypoint in path")
    field(INP, "$(P)Path$(N):$(K):get_wp_info.SVAL CP")
}

# INP link to Waypoint:Reached set by get_wp_info func
record(ai, "$(P)Path$(N):$(K):Reached") {
    field(DESC, "1 if robot at waypoint, else 0")
}

# NOTE: lua epics.put directly to ActionOpt PV throws mutex error,
# probably because of logic in waypoint databases, which is why we
# need to do the following
record(longout, "$(P)Path$(N):$(K):action_opt_val") {}

record(seq, "$(P)Path$(N):$(K):set_action_opt") {
    field(DOL0, "$(P)Path$(N):$(K):action_opt_val.VAL")
}
